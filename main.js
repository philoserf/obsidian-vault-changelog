var{defineProperty:r,getOwnPropertyNames:f,getOwnPropertyDescriptor:v}=Object,x=Object.prototype.hasOwnProperty;var p=new WeakMap,F=(e)=>{var t=p.get(e),a;if(t)return t;if(t=r({},"__esModule",{value:!0}),e&&typeof e==="object"||typeof e==="function")f(e).map((s)=>!x.call(t,s)&&r(t,s,{get:()=>e[s],enumerable:!(a=v(e,s))||a.enumerable}));return p.set(e,t),t};var C=(e,t)=>{for(var a in t)r(e,a,{get:t[a],enumerable:!0,configurable:!0,set:(s)=>t[a]=()=>s})};var w={};C(w,{default:()=>u});module.exports=F(w);var l=require("obsidian");var o=require("obsidian");var m=require("obsidian");class d extends m.AbstractInputSuggest{inputEl;constructor(e,t){super(e,t);this.inputEl=t}getSuggestions(e){let t=e.toLowerCase(),a=this.app.vault.getAllFolders(),s=this.app.vault.getFiles().filter((n)=>n.extension==="md"),i=[];return a.forEach((n)=>{let g=n.path;if(g.toLowerCase().contains(t))i.push(`${g}/`)}),s.forEach((n)=>{let g=n.path;if(g.toLowerCase().contains(t))i.push(g)}),i}renderSuggestion(e,t){t.setText(e)}selectSuggestion(e){this.inputEl.value=e,this.inputEl.trigger("input"),this.close()}}var h={autoUpdate:!1,changelogPath:"Changelog.md",datetimeFormat:"YYYY-MM-DD[T]HHmm",maxRecentFiles:25,excludedFolders:[],useWikiLinks:!0,changelogHeading:""};class c extends o.PluginSettingTab{plugin;constructor(e,t){super(e,t);this.plugin=t}renderExcludedFolders(e){if(e.empty(),this.plugin.settings.excludedFolders.length===0){e.createEl("div",{text:"No excluded folders"});return}this.plugin.settings.excludedFolders.forEach((t)=>{let a=e.createDiv("excluded-folder-item");a.createSpan({text:t}),a.createEl("button",{text:"✕",cls:"excluded-folder-remove"}).addEventListener("click",async()=>{let i=this.plugin.settings.excludedFolders.indexOf(t);if(i>-1)this.plugin.settings.excludedFolders.splice(i,1),await this.plugin.saveSettings(),this.renderExcludedFolders(e)})})}display(){let{containerEl:e}=this,{settings:t}=this.plugin;e.empty(),new o.Setting(e).setName("Auto update").setDesc("Automatically update changelog on vault changes").addToggle((s)=>s.setValue(t.autoUpdate).onChange(async(i)=>{if(t.autoUpdate=i,await this.plugin.saveSettings(),i)this.plugin.enableAutoUpdate()})),new o.Setting(e).setName("Changelog path").setDesc("Relative path including filename and extension").addText((s)=>{s.setPlaceholder("Folder/Changelog.md").setValue(t.changelogPath).onChange(async(i)=>{t.changelogPath=o.normalizePath(i),await this.plugin.saveSettings()}),new d(this.app,s.inputEl)}),new o.Setting(e).setName("Datetime format").setDesc("Moment.js datetime format string").addText((s)=>s.setPlaceholder("YYYY-MM-DD[T]HHmm").setValue(t.datetimeFormat).onChange(async(i)=>{if(window.moment().format(i)==="Invalid date"){s.setValue(t.datetimeFormat),new o.Notice("Invalid datetime format");return}t.datetimeFormat=i,await this.plugin.saveSettings()})),new o.Setting(e).setName("Max recent files").setDesc("Maximum number of recently edited files to include").addText((s)=>s.setValue(t.maxRecentFiles.toString()).onChange(async(i)=>{let n=Number(i);if(Number.isNaN(n)||n<1){s.setValue(t.maxRecentFiles.toString());return}t.maxRecentFiles=n,await this.plugin.saveSettings()})),new o.Setting(e).setName("Use wiki-links").setDesc("Format filenames as wiki-links [[note]] instead of plain text").addToggle((s)=>s.setValue(t.useWikiLinks).onChange(async(i)=>{t.useWikiLinks=i,await this.plugin.saveSettings()})),new o.Setting(e).setName("Changelog heading").setDesc("Optional heading to prepend to the changelog (e.g., # Changelog). Leave empty for no heading.").addText((s)=>s.setPlaceholder("# Changelog").setValue(t.changelogHeading).onChange(async(i)=>{t.changelogHeading=i,await this.plugin.saveSettings()})),e.createEl("h3",{text:"Excluded folders"});let a=e.createDiv("excluded-folders-list");this.renderExcludedFolders(a),new o.Setting(e).setName("Add excluded folder").setDesc("Folders to exclude from the changelog").addText((s)=>{s.setPlaceholder("folder/path/"),new d(this.app,s.inputEl)}).addButton((s)=>{s.setButtonText("Add").onClick(async()=>{let i=s.buttonEl.parentElement?.querySelector("input");if(i){let n=i.value;if(n&&!t.excludedFolders.includes(n))t.excludedFolders.push(n),await this.plugin.saveSettings(),i.value="",this.renderExcludedFolders(a)}})})}}class u extends l.Plugin{settings=h;async onload(){await this.loadSettings(),this.addSettingTab(new c(this.app,this)),this.addCommand({id:"update-changelog",name:"Update Changelog",callback:()=>this.updateChangelog()}),this.loadStyles(),this.onVaultChange=l.debounce(this.onVaultChange.bind(this),200),this.enableAutoUpdate()}onunload(){}async loadStyles(){let e=await this.app.vault.adapter.read(`${this.manifest.dir}/styles.css`);this.registerStyles(e)}registerStyles(e){let t=document.createElement("style");t.textContent=e,this.register(()=>t.remove()),document.head.appendChild(t)}enableAutoUpdate(){if(this.settings.autoUpdate)this.registerEvent(this.app.vault.on("modify",(e)=>{if(e instanceof l.TFile)this.onVaultChange(e)})),this.registerEvent(this.app.vault.on("delete",(e)=>{if(e instanceof l.TFile)this.onVaultChange(e)})),this.registerEvent(this.app.vault.on("rename",(e)=>{if(e instanceof l.TFile)this.onVaultChange(e)}))}onVaultChange(e){if(e.path!==this.settings.changelogPath)this.updateChangelog()}async updateChangelog(){let e=await this.generateChangelog();await this.writeToFile(this.settings.changelogPath,e)}async generateChangelog(){let e=this.getRecentlyEditedFiles(),t="";if(this.settings.changelogHeading)t+=`${this.settings.changelogHeading}

`;return e.forEach((a)=>{let i=window.moment(a.stat.mtime).format(this.settings.datetimeFormat),n=this.settings.useWikiLinks?`[[${a.basename}]]`:a.basename;t+=`- ${i} · ${n}
`}),t}getRecentlyEditedFiles(){return this.app.vault.getMarkdownFiles().filter((e)=>{if(e.path===this.settings.changelogPath)return!1;for(let t of this.settings.excludedFolders)if(e.path.startsWith(t))return!1;return!0}).sort((e,t)=>t.stat.mtime-e.stat.mtime).slice(0,this.settings.maxRecentFiles)}async writeToFile(e,t){let a=this.app.vault.getAbstractFileByPath(e);if(!a)a=await this.app.vault.create(e,"");if(a instanceof l.TFile)await this.app.vault.modify(a,t);else new l.Notice(`Could not update changelog at path: ${e}`)}async loadSettings(){let e=await this.loadData();this.settings={...h,...e}}async saveSettings(){await this.saveData(this.settings)}}
